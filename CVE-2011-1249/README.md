### CVE-2011-1249

#### 描述

The Ancillary Function Driver (AFD) in afd.sys in Microsoft Windows XP SP2 and SP3, Windows Server 2003 SP2, Windows Vista SP1 and SP2, Windows Server 2008 Gold, SP2, R2, and R2 SP1, and Windows 7 Gold and SP1 does not properly validate user-mode input, which allows local users to gain privileges via a crafted application, aka "Ancillary Function Driver Elevation of Privilege Vulnerability."

#### 影响版本

| Product             | Version | Update | Edition | Tested |
| ------------------- | ------- | ------ | ------- | ------ |
| Windows 2003 Server |         | SP2    |         |        |
| Windows 7           | -       | SP1    | X64     |        |
| Windows 7           | -       | SP1    | X86     |        |
| Windows Server 2003 |         | SP2    | Itanium |        |
| Windows Server 2003 |         | SP2    | X64     |        |
| Windows Server 2008 | -       | SP2    | Itanium |        |
| Windows Server 2008 |         |        | X32     |        |
| Windows Server 2008 |         |        | X64     |        |
| Windows Server 2008 |         | SP2    | X32     |        |
| Windows Server 2008 |         | SP2    | X64     |        |
| Windows Server 2008 |         |        | Itanium |        |
| Windows Server 2008 | R2      |        | Itanium |        |
| Windows Server 2008 | R2      |        | X64     |        |
| Windows Server 2008 | R2      | SP1    | Itanium |        |
| Windows Server 2008 | R2      | SP1    | X64     |        |
| Windows Vista       |         | SP1    |         |        |
| Windows Vista       |         | SP2    |         |        |
| Windows Xp          | -       | SP2    | X64     |        |
| Windows Xp          |         | SP3    |         |        |

#### 修复补丁

```
https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2011-1249
```

#### 利用方式

编译文件

```
i686-w64-mingw32-gcc CVE-2011-1249.c -o CVE-2011-1249.exe -lws2_32
```

测试系统windows server 2003 sp2 x86和windows 7 sp1 x86都成功

![23](https://github.com/Ascotbe/Random-img/blob/master/WindowsKernelExploits/CVE-2011-1249_win2003_x86.gif?raw=true)

### 